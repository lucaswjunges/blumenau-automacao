<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Produto | Blumenau Automa√ß√£o</title>
    <meta name="description" content="Detalhes do produto - Blumenau Automa√ß√£o">

    <link rel="icon" type="image/png" href="logo1.png">
    <link rel="apple-touch-icon" href="logo1.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            900: '#1a1a2e',
                            800: '#16213e',
                            700: '#1f2b47',
                            600: '#2a3a5a'
                        },
                        accent: {
                            500: '#195F79',
                            400: '#4a9bb5',
                            300: '#7ab8c9'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>

    <style>
        .gradient-text {
            background: linear-gradient(135deg, #7ab8c9 0%, #195F79 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #195F79 0%, #7ab8c9 100%);
        }
        .thumbnail-active {
            border-color: #4a9bb5 !important;
        }
    </style>
</head>
<body class="bg-primary-900 text-gray-200 font-sans">

    <!-- Header -->
    <header class="fixed top-0 left-0 right-0 z-50 bg-primary-900/95 backdrop-blur-sm border-b border-primary-700">
        <div class="max-w-[1400px] mx-auto px-4 sm:px-6">
            <div class="flex items-center justify-between h-16 md:h-20">
                <a href="index.html" class="flex items-center space-x-3">
                    <img src="logo1.png" alt="Blumenau Automa√ß√£o" class="h-10 md:h-12 w-auto">
                    <span class="text-xl md:text-2xl font-bold gradient-text">Blumenau Automa√ß√£o</span>
                </a>

                <nav class="hidden lg:flex items-center space-x-5">
                    <a href="index.html#servicos" class="text-gray-300 hover:text-white transition-colors whitespace-nowrap">Servi√ßos</a>
                    <a href="tecnologias.html" class="text-gray-300 hover:text-white transition-colors whitespace-nowrap">Solu√ß√µes</a>
                    <a href="know-how.html" class="text-gray-300 hover:text-white transition-colors whitespace-nowrap">Know-How</a>
                    <a href="produtos.html" class="text-accent-400 whitespace-nowrap">Produtos</a>
                    <a href="index.html#cases" class="text-gray-300 hover:text-white transition-colors whitespace-nowrap">Cases</a>
                    <a href="index.html#sobre" class="text-gray-300 hover:text-white transition-colors whitespace-nowrap">Sobre</a>
                    <a href="index.html#contato" class="text-gray-300 hover:text-white transition-colors whitespace-nowrap">Contato</a>
                    <a href="area-cliente.html" class="px-3 py-1.5 bg-primary-900 text-white rounded-lg hover:bg-primary-700 transition-colors whitespace-nowrap text-sm flex items-center gap-1.5">
                        üîê √Årea do Cliente
                    </a>
                    <a href="produtos.html#carrinho" id="cart-icon" class="relative p-2 text-gray-300 hover:text-white transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/>
                        </svg>
                        <span id="cart-count" class="absolute -top-1 -right-1 bg-accent-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center hidden">0</span>
                    </a>
                </nav>

                <div class="hidden lg:flex items-center">
                    <a href="index.html#contato" class="gradient-bg text-white px-4 py-2 rounded-lg font-medium hover:opacity-90 transition-opacity whitespace-nowrap text-sm">
                        Or√ßamento
                    </a>
                </div>

                <button id="mobile-menu-btn" class="lg:hidden p-2 text-gray-300 hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                    </svg>
                </button>
            </div>
        </div>

        <div id="mobile-menu" class="hidden lg:hidden bg-primary-800 border-t border-primary-700">
            <div class="px-4 py-4 space-y-3">
                <a href="index.html#servicos" class="block text-gray-300 hover:text-white py-2">Servi√ßos</a>
                <a href="tecnologias.html" class="block text-gray-300 hover:text-white py-2">Solu√ß√µes</a>
                <a href="know-how.html" class="block text-gray-300 hover:text-white py-2">Know-How</a>
                <a href="produtos.html" class="block text-accent-400 py-2">Produtos</a>
                <a href="index.html#cases" class="block text-gray-300 hover:text-white py-2">Cases</a>
                <a href="index.html#sobre" class="block text-gray-300 hover:text-white py-2">Sobre</a>
                <a href="index.html#contato" class="block text-gray-300 hover:text-white py-2">Contato</a>
                <a href="area-cliente.html" class="inline-flex items-center gap-2 bg-primary-900 text-white px-4 py-2 rounded-lg mt-2">
                    üîê √Årea do Cliente
                </a>
            </div>
        </div>
    </header>

    <!-- Loading State -->
    <div id="loading" class="pt-28 pb-16 min-h-screen flex items-center justify-center">
        <div class="text-center">
            <svg class="w-12 h-12 mx-auto animate-spin text-accent-400" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p class="mt-4 text-gray-400">Carregando produto...</p>
        </div>
    </div>

    <!-- Error State -->
    <div id="error" class="hidden pt-28 pb-16 min-h-screen flex items-center justify-center">
        <div class="text-center">
            <svg class="w-16 h-16 mx-auto text-red-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
            </svg>
            <h2 class="text-2xl font-bold mb-2">Produto n√£o encontrado</h2>
            <p class="text-gray-400 mb-6">O produto que voc√™ procura n√£o existe ou foi removido.</p>
            <a href="produtos.html" class="gradient-bg text-white px-6 py-3 rounded-xl font-semibold hover:opacity-90 transition-opacity inline-block">
                Ver Todos os Produtos
            </a>
        </div>
    </div>

    <!-- Product Content -->
    <main id="product-content" class="hidden pt-24 pb-16">
        <div class="max-w-[1400px] mx-auto px-4 sm:px-6">

            <!-- Breadcrumb -->
            <nav id="breadcrumb" class="text-sm text-gray-400 mb-6 pt-4">
                <a href="index.html" class="hover:text-white">Home</a>
                <span class="mx-2">/</span>
                <a href="produtos.html" class="hover:text-white">Produtos</a>
                <span class="mx-2">/</span>
                <span id="breadcrumb-category" class="hover:text-white"></span>
                <span class="mx-2">/</span>
                <span id="breadcrumb-product" class="text-gray-300"></span>
            </nav>

            <div class="grid lg:grid-cols-2 gap-8 lg:gap-12">

                <!-- Image Gallery -->
                <div class="space-y-4">
                    <!-- Main Image -->
                    <div class="bg-primary-800 rounded-2xl p-4 aspect-square flex items-center justify-center overflow-hidden">
                        <img id="main-image" src="" alt="" class="max-w-full max-h-full object-contain rounded-lg">
                    </div>

                    <!-- Thumbnails -->
                    <div id="thumbnails" class="flex gap-3 overflow-x-auto pb-2">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Product Info -->
                <div class="space-y-6">
                    <!-- Brand -->
                    <div id="brand-badge" class="hidden">
                        <span class="inline-block px-3 py-1 bg-accent-500/20 text-accent-400 text-sm rounded-full font-medium"></span>
                    </div>

                    <!-- Title -->
                    <h1 id="product-name" class="text-3xl md:text-4xl font-bold"></h1>

                    <!-- SKU -->
                    <p id="product-sku" class="text-gray-400 text-sm"></p>

                    <!-- Price -->
                    <div class="space-y-2">
                        <p id="product-price" class="text-4xl font-bold text-accent-400"></p>
                        <p class="text-sm text-gray-400">
                            ou consulte condi√ß√µes especiais via WhatsApp
                        </p>
                    </div>

                    <!-- Stock Status -->
                    <div id="stock-status" class="flex items-center gap-2">
                        <!-- Populated by JS -->
                    </div>

                    <!-- Description -->
                    <div id="description-section" class="hidden">
                        <h3 class="text-lg font-semibold mb-2">Descri√ß√£o</h3>
                        <div id="product-description" class="text-gray-300 leading-relaxed prose prose-invert prose-sm max-w-none [&_table]:w-full [&_table]:border-collapse [&_th]:bg-primary-700 [&_th]:text-left [&_th]:p-2 [&_th]:border [&_th]:border-primary-600 [&_td]:p-2 [&_td]:border [&_td]:border-primary-600 [&_tr:nth-child(even)]:bg-primary-700/30"></div>
                    </div>

                    <!-- Actions -->
                    <div class="flex flex-col gap-3 pt-4">
                        <!-- Bot√£o Principal: Comprar Agora -->
                        <button id="buy-now-btn" class="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white py-4 px-6 rounded-xl font-bold text-lg hover:opacity-90 transition-opacity flex items-center justify-center gap-2 shadow-lg shadow-green-500/25">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                            </svg>
                            Comprar Agora
                        </button>

                        <div class="flex flex-col sm:flex-row gap-3">
                            <button id="add-to-cart-btn" class="flex-1 gradient-bg text-white py-3 px-6 rounded-xl font-semibold hover:opacity-90 transition-opacity flex items-center justify-center gap-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/>
                                </svg>
                                Adicionar ao Carrinho
                            </button>

                            <a id="whatsapp-btn" href="#" target="_blank" class="flex-1 bg-primary-700 text-white py-3 px-6 rounded-xl font-semibold hover:bg-primary-600 transition-colors flex items-center justify-center gap-2">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
                                </svg>
                                WhatsApp
                            </a>
                        </div>

                        <!-- Pagamento seguro -->
                        <div class="flex items-center justify-center gap-3 pt-2">
                            <span class="text-xs text-gray-500">Pagamento seguro:</span>
                            <!-- Pix -->
                            <div class="flex items-center gap-1 text-gray-400" title="Pix">
                                <svg class="h-4 w-4" viewBox="0 0 512 512" fill="currentColor">
                                    <path d="M242.4 292.5C247.8 287.1 257.1 287.1 262.5 292.5L339.5 369.5C353.7 383.7 googl372.5 googl391.6 395.2 googl404 419.7 404 444.3 395.2 463.5 376L506.5 333C525.7 313.8 534.5 289.2 534.5 264.5C534.5 240 525.7 215.3 506.5 196.1L463.5 153.1C451.7 141.3 437.1 134 421.5 131.9L377.6 133.6C363.5 134.1 349.8 128.7 339.6 118.5L262.5 41.4C257.1 36 247.8 36 242.4 41.4L165.4 118.4C155.2 128.6 141.5 134 127.4 133.5L83.46 131.8C67.96 134 53.3 141.3 41.52 153.1L-1.488 196.1C-20.68 215.3 -29.46 239.9 -29.46 264.5C-29.46 289.1 -20.68 313.8 -1.488 333L41.52 376C60.72 395.2 85.32 404 109.9 404C134.5 404 159.2 395.2 178.4 376L178.4 376L242.4 292.5zM261.1 107.5L305.8 152.2C327.6 173.1 356.6 183.3 385.8 181.6L428.9 179.9C433.5 179.8 437.8 181.4 441.2 184.7L484.2 227.7C493.1 236.6 498.5 248.9 498.5 261.5C498.5 274.1 493.1 286.4 484.2 295.3L441.2 338.3C437.8 341.6 433.5 343.2 428.9 343.1L385.8 341.4C356.6 339.7 327.6 349.9 305.8 370.8L261.1 415.5C257.1 419.5 250.8 419.5 246.9 415.5L202.2 370.8C180.4 349.9 151.4 339.7 122.2 341.4L79.07 343.1C74.47 343.2 70.18 341.6 66.81 338.3L23.81 295.3C14.93 286.4 9.538 274.1 9.538 261.5C9.538 248.9 14.93 236.6 23.81 227.7L66.81 184.7C70.18 181.4 74.47 179.8 79.07 179.9L122.2 181.6C151.4 183.3 180.4 173.1 202.2 152.2L246.9 107.5C250.8 103.5 257.1 103.5 261.1 107.5V107.5z"/>
                                </svg>
                                <span class="text-xs">Pix</span>
                            </div>
                            <!-- Cart√£o -->
                            <div class="flex items-center gap-1 text-gray-400" title="Cart√£o de Cr√©dito">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                                </svg>
                                <span class="text-xs">Cart√£o</span>
                            </div>
                            <!-- Boleto -->
                            <div class="flex items-center gap-1 text-gray-400" title="Boleto">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                                <span class="text-xs">Boleto</span>
                            </div>
                        </div>
                    </div>

                    <!-- Link para fornecedor -->
                    <div id="supplier-link" class="hidden pt-4 border-t border-primary-700 mt-4">
                        <a id="supplier-url" href="#" target="_blank" rel="noopener noreferrer"
                           class="inline-flex items-center gap-2 text-sm text-gray-400 hover:text-accent-400 transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                            </svg>
                            Ver produto no fornecedor (Proesi)
                        </a>
                    </div>
                </div>
            </div>

            <!-- Specifications -->
            <section id="specs-section" class="hidden mt-12">
                <div class="bg-primary-800 rounded-2xl p-6 md:p-8">
                    <h2 class="text-2xl font-bold mb-6">Especifica√ß√µes T√©cnicas</h2>
                    <div id="specs-table" class="grid md:grid-cols-2 gap-4">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </section>

            <!-- Datasheet -->
            <section id="datasheet-section" class="hidden mt-8">
                <a id="datasheet-link" href="#" target="_blank" class="inline-flex items-center gap-3 bg-primary-800 hover:bg-primary-700 transition-colors rounded-xl px-6 py-4">
                    <svg class="w-8 h-8 text-red-500" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zM6 20V4h7v5h5v11H6z"/>
                        <path d="M8 12h8v2H8zm0 4h8v2H8z"/>
                    </svg>
                    <div>
                        <p class="font-semibold">Datasheet / Manual</p>
                        <p class="text-sm text-gray-400">Baixar PDF com especifica√ß√µes completas</p>
                    </div>
                </a>
            </section>

            <!-- Related Products -->
            <section id="related-section" class="hidden mt-16">
                <h2 class="text-2xl font-bold mb-6">Produtos Relacionados</h2>
                <div id="related-products" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <!-- Populated by JS -->
                </div>
            </section>

        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-primary-800 border-t border-primary-700 py-8 mt-auto">
        <div class="max-w-[1400px] mx-auto px-4 sm:px-6 text-center text-gray-400 text-sm">
            <p>&copy; 2025 Blumenau Automa√ß√£o. Todos os direitos reservados.</p>
            <p class="mt-2">Rua Jo√£o Pessoa, 2750, Bloco B - Velha, Blumenau/SC, 89036-256</p>
        </div>
    </footer>

    <script>
        let product = null;
        let allProducts = [];

        // Get product ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('id');
        const productSlug = urlParams.get('slug');

        // Format price
        function formatPrice(price) {
            if (!price) return 'Sob consulta';
            return `R$ ${price.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
        }

        // Load products data
        async function loadProduct() {
            try {
                const response = await fetch('products.json');
                if (!response.ok) throw new Error('Failed to load products');

                const data = await response.json();
                allProducts = data.products || [];

                // Find product by ID or slug
                product = allProducts.find(p =>
                    p.id === productId ||
                    p.slug === productSlug ||
                    p.slug === productId
                );

                if (!product) {
                    showError();
                    return;
                }

                renderProduct();
            } catch (error) {
                console.error('Error loading product:', error);
                showError();
            }
        }

        function showError() {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('error').classList.remove('hidden');
        }

        // Formata a descri√ß√£o no estilo Proesi
        // skipSpecs = true quando a API j√° forneceu specs separadamente
        function formatDescription(desc, skipSpecs = false) {
            if (!desc) return '';

            // Padr√µes para detectar se√ß√µes (apenas t√≠tulos de se√ß√£o, n√£o palavras no meio do texto)
            // Deve ter ":" depois e estar no in√≠cio ou ap√≥s pontua√ß√£o
            const sectionPatterns = {
                caracteristicas: /(?:^|\.\s+|\n)Caracter√≠sticas:\s/i,
                specs: /(?:^|\.\s+|\n)(?:Especifica√ß√µes(?:\s*T√©cnicas)?|Dados T√©cnicos|Caracter√≠sticas T√©cnicas):\s/i
            };

            let mainDesc = desc;
            let caracteristicasText = '';
            let specsText = '';

            // Extrai se√ß√µes do texto
            // Primeiro encontra onde cada se√ß√£o come√ßa
            const caracteristicasMatch = desc.match(sectionPatterns.caracteristicas);
            const specsMatch = desc.match(sectionPatterns.specs);

            // Ajusta index para come√ßar no t√≠tulo (pula o . ou \n que precede)
            let caracteristicasIndex = -1;
            if (caracteristicasMatch) {
                caracteristicasIndex = caracteristicasMatch.index;
                // Pula caractere inicial se for . ou \n
                if (desc[caracteristicasIndex] === '.' || desc[caracteristicasIndex] === '\n') {
                    caracteristicasIndex += desc.substring(caracteristicasIndex).search(/[A-Za-z]/);
                }
            }

            let specsIndex = -1;
            if (specsMatch) {
                specsIndex = specsMatch.index;
                if (desc[specsIndex] === '.' || desc[specsIndex] === '\n') {
                    specsIndex += desc.substring(specsIndex).search(/[A-Za-z]/);
                }
            }

            // Determina a ordem das se√ß√µes e extrai o texto
            if (caracteristicasIndex >= 0 && specsIndex >= 0) {
                // Ambas se√ß√µes existem
                if (caracteristicasIndex < specsIndex) {
                    mainDesc = desc.substring(0, caracteristicasIndex).trim();
                    caracteristicasText = desc.substring(caracteristicasIndex, specsIndex).trim();
                    specsText = desc.substring(specsIndex).trim();
                } else {
                    mainDesc = desc.substring(0, specsIndex).trim();
                    specsText = desc.substring(specsIndex, caracteristicasIndex).trim();
                    caracteristicasText = desc.substring(caracteristicasIndex).trim();
                }
            } else if (caracteristicasIndex >= 0) {
                mainDesc = desc.substring(0, caracteristicasIndex).trim();
                caracteristicasText = desc.substring(caracteristicasIndex).trim();
            } else if (specsIndex >= 0 && !skipSpecs) {
                mainDesc = desc.substring(0, specsIndex).trim();
                specsText = desc.substring(specsIndex).trim();
            }

            // Se skipSpecs (API j√° forneceu), limpa specsText
            if (skipSpecs) {
                specsText = '';
            }

            // Formata descri√ß√£o principal com par√°grafos
            // Detecta onde quebrar par√°grafos (frases que terminam com . seguido de mai√∫scula)
            let formattedMain = mainDesc
                .replace(/\.([A-Z])/g, '.</p><p class="mb-4">$1')
                .replace(/\n\n/g, '</p><p class="mb-4">')
                .replace(/\n/g, '<br>');

            // Detecta subt√≠tulos (texto seguido de :)
            formattedMain = formattedMain.replace(
                /([A-Z][^.!?:]{5,40}:)(?!\d)/g,
                '</p><h4 class="text-base font-semibold text-white mt-6 mb-2">$1</h4><p class="mb-4">'
            );

            let html = `<div class="space-y-4"><p class="mb-4">${formattedMain}</p></div>`;

            // Se tem se√ß√£o de Caracter√≠sticas
            if (caracteristicasText) {
                // Remove o t√≠tulo
                const caracContent = caracteristicasText.replace(/^Caracter√≠sticas:?\s*/i, '').trim();

                // Extrai itens como lista (geralmente s√£o frases curtas ou bullet points)
                const caracItems = caracContent
                    .split(/(?=[A-Z][^.]{10,}[.:])|(?=[-‚Ä¢]\s)/)
                    .map(item => item.replace(/^[-‚Ä¢]\s*/, '').trim())
                    .filter(item => item.length > 5);

                if (caracItems.length > 0) {
                    html += `
                        <div class="mt-8 pt-8 border-t-2 border-accent-500/30">
                            <h3 class="text-xl font-bold mb-6 text-accent-400 flex items-center gap-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                </svg>
                                Caracter√≠sticas
                            </h3>
                            <ul class="space-y-3">
                                ${caracItems.map(item => `
                                    <li class="flex items-start gap-3">
                                        <span class="flex-shrink-0 w-1.5 h-1.5 bg-accent-400 rounded-full mt-2"></span>
                                        <span class="text-gray-300">${item}</span>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                    `;
                }
            }

            // Se tem specs embutidos, formata como se√ß√£o separada
            if (specsText) {
                // Remove o t√≠tulo de specs do texto
                specsText = specsText.replace(/^(Especifica√ß√µes T√©cnicas|Dados T√©cnicos|Caracter√≠sticas T√©cnicas|Caracter√≠sticas):?\s*/i, '');

                // Detecta subse√ß√µes (ex: "Conjunto Geral:", "Esta√ß√£o de Retrabalho:")
                const sections = specsText.split(/([A-Z][^:]{3,30}:)(?=\s*[A-Z])/);

                let specsHtml = '';
                let currentSection = '';
                const specPairs = [];

                for (let i = 0; i < sections.length; i++) {
                    const part = sections[i].trim();
                    if (!part) continue;

                    // √â um t√≠tulo de subse√ß√£o?
                    if (part.match(/^[A-Z][^:]{3,30}:$/) && i + 1 < sections.length) {
                        if (specPairs.length > 0) {
                            specsHtml += renderSpecsTable(specPairs, currentSection);
                            specPairs.length = 0;
                        }
                        currentSection = part.replace(/:$/, '');
                    } else {
                        // Extrai pares chave:valor
                        const pairs = part.split(/(?=[A-Z][^:]{2,30}:)/);
                        for (const pair of pairs) {
                            const colonIndex = pair.indexOf(':');
                            if (colonIndex > 0 && colonIndex < 40) {
                                const key = pair.substring(0, colonIndex).trim();
                                const value = pair.substring(colonIndex + 1).trim();
                                if (key && value) {
                                    specPairs.push({ key, value });
                                }
                            }
                        }
                    }
                }

                // Renderiza √∫ltima se√ß√£o
                if (specPairs.length > 0) {
                    specsHtml += renderSpecsTable(specPairs, currentSection);
                }

                if (specsHtml) {
                    html += `
                        <div class="mt-8 pt-8 border-t-2 border-accent-500/30">
                            <h3 class="text-xl font-bold mb-6 text-accent-400 flex items-center gap-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/>
                                </svg>
                                Especifica√ß√µes T√©cnicas
                            </h3>
                            ${specsHtml}
                        </div>
                    `;
                }
            }

            return html;
        }

        // Renderiza tabela de especifica√ß√µes
        function renderSpecsTable(specs, sectionTitle) {
            if (!specs || specs.length === 0) return '';

            let html = '';
            if (sectionTitle) {
                html += `<h4 class="text-sm font-semibold text-gray-300 uppercase tracking-wide mt-6 mb-3 pb-2 border-b border-primary-600">${sectionTitle}</h4>`;
            }

            html += `<div class="bg-primary-700/30 rounded-lg overflow-hidden mb-4">
                <table class="w-full text-sm">
                    <tbody>
                        ${specs.map((s, i) => `
                            <tr class="${i % 2 === 0 ? 'bg-primary-700/50' : ''}">
                                <td class="py-2.5 px-4 text-gray-400 font-medium w-2/5">${s.key}</td>
                                <td class="py-2.5 px-4 text-white">${s.value}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>`;

            return html;
        }

        // Busca descri√ß√£o completa do produto na Proesi
        async function fetchFullDescription(sourceUrl, descEl) {
            try {
                const apiUrl = `/api/product-description?url=${encodeURIComponent(sourceUrl)}`;
                const response = await fetch(apiUrl);

                if (!response.ok) return;

                const data = await response.json();

                if (data.success && data.hasContent) {
                    const hasApiSpecs = data.specs && Object.keys(data.specs).length > 0;
                    const hasApiTables = data.tables && data.tables.length > 0;

                    if (data.description) {
                        // Limpa CSS vazado e formata descri√ß√£o
                        let cleanDesc = data.description
                            .replace(/p\s*\{[^}]*\}/g, '')  // Remove p{...}
                            .replace(/td\s*\{[^}]*\}/g, '') // Remove td{...}
                            .replace(/^\s+/, '');            // Remove espa√ßos iniciais

                        // Se tem tabela da API, remove a parte de specs/dados t√©cnicos do texto
                        if (hasApiTables || hasApiSpecs) {
                            cleanDesc = cleanDesc.replace(/Dados T√©cnicos:[\s\S]*/i, '').trim();
                            cleanDesc = cleanDesc.replace(/Especifica√ß√µes:[\s\S]*/i, '').trim();
                        }

                        descEl.innerHTML = formatDescription(cleanDesc, hasApiSpecs || hasApiTables);
                    }

                    // Se veio tabela HTML da API, usar diretamente
                    if (hasApiTables) {
                        const specsSection = document.getElementById('specs-section');
                        const specsTable = document.getElementById('specs-table');

                        // Limpa e estiliza a tabela HTML original
                        let tableHtml = data.tables[0]
                            .replace(/style="[^"]*"/g, '')  // Remove estilos inline
                            .replace(/class="[^"]*"/g, '')  // Remove classes originais
                            .replace(/width="[^"]*"/g, '')
                            .replace(/height="[^"]*"/g, '')
                            .replace(/border="[^"]*"/g, '')
                            .replace(/cellspacing="[^"]*"/g, '')
                            .replace(/cellpadding="[^"]*"/g, '')
                            .replace(/<colgroup>[\s\S]*?<\/colgroup>/g, '')
                            .replace(/<table/g, '<table class="w-full text-sm"')
                            .replace(/<tr/g, '<tr class="border-b border-primary-600 hover:bg-primary-700/30"')
                            .replace(/<td/g, '<td class="py-3 px-4"');

                        specsSection.classList.remove('hidden');
                        specsTable.innerHTML = `
                            <div class="bg-primary-700/30 rounded-lg overflow-hidden">
                                ${tableHtml}
                            </div>
                        `;
                    } else if (hasApiSpecs) {
                        // Fallback: usa specs extra√≠dos como tabela
                        const specsSection = document.getElementById('specs-section');
                        const specsTable = document.getElementById('specs-table');
                        const mergedSpecs = { ...(product.specs || {}), ...data.specs };

                        specsSection.classList.remove('hidden');
                        specsTable.innerHTML = `
                            <div class="bg-primary-700/30 rounded-lg overflow-hidden">
                                <table class="w-full text-sm">
                                    <tbody>
                                        ${Object.entries(mergedSpecs).map(([key, value], i) => `
                                            <tr class="border-b border-primary-600 hover:bg-primary-700/30 ${i % 2 === 0 ? 'bg-primary-700/20' : ''}">
                                                <td class="py-3 px-4 text-gray-400 font-medium w-2/5">${key}</td>
                                                <td class="py-3 px-4 text-white">${value}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        `;
                    }
                }
            } catch (error) {
                console.log('N√£o foi poss√≠vel buscar descri√ß√£o completa:', error);
                // Mant√©m a descri√ß√£o local se falhar
            }
        }

        function renderProduct() {
            // Update page title and meta
            document.title = `${product.name} | Blumenau Automa√ß√£o`;

            // Hide loading, show content
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('product-content').classList.remove('hidden');

            // Breadcrumb
            if (product.categoryPath && product.categoryPath.length > 0) {
                document.getElementById('breadcrumb-category').innerHTML =
                    `<a href="produtos.html?category=${product.category}" class="hover:text-white">${product.categoryPath[product.categoryPath.length - 1]}</a>`;
            } else if (product.category) {
                document.getElementById('breadcrumb-category').textContent = product.category;
            }
            document.getElementById('breadcrumb-product').textContent = product.name;

            // Main image
            const mainImg = document.getElementById('main-image');
            mainImg.src = product.image || 'https://via.placeholder.com/600x600?text=Sem+Imagem';
            mainImg.alt = product.name;

            // Thumbnails
            const thumbnailsContainer = document.getElementById('thumbnails');
            const images = product.images || (product.image ? [product.image] : []);

            if (images.length > 1) {
                thumbnailsContainer.innerHTML = images.map((img, index) => `
                    <button onclick="setMainImage('${img}')" class="flex-shrink-0 w-20 h-20 bg-primary-700 rounded-lg overflow-hidden border-2 ${index === 0 ? 'thumbnail-active border-accent-400' : 'border-transparent hover:border-primary-600'} transition-colors">
                        <img src="${img}" alt="Imagem ${index + 1}" class="w-full h-full object-contain">
                    </button>
                `).join('');
            }

            // Brand
            if (product.brand) {
                const brandBadge = document.getElementById('brand-badge');
                brandBadge.classList.remove('hidden');
                brandBadge.querySelector('span').textContent = product.brand;
            }

            // Name
            document.getElementById('product-name').textContent = product.name;

            // SKU
            if (product.sku) {
                document.getElementById('product-sku').textContent = `SKU: ${product.sku}`;
            }

            // Supplier link
            if (product.sourceUrl) {
                const supplierLink = document.getElementById('supplier-link');
                const supplierUrl = document.getElementById('supplier-url');
                supplierLink.classList.remove('hidden');
                supplierUrl.href = product.sourceUrl;
            }

            // Price
            document.getElementById('product-price').textContent = product.priceFormatted || formatPrice(product.price);

            // Stock status
            const stockStatus = document.getElementById('stock-status');
            if (product.inStock) {
                const stockText = product.stock ? `${product.stock} unidades` : 'Dispon√≠vel';
                stockStatus.innerHTML = `
                    <span class="w-3 h-3 bg-green-500 rounded-full"></span>
                    <span class="text-green-400 font-medium">Em estoque</span>
                    <span class="text-gray-400">(${stockText})</span>
                `;
            } else {
                stockStatus.innerHTML = `
                    <span class="w-3 h-3 bg-red-500 rounded-full"></span>
                    <span class="text-red-400 font-medium">Indispon√≠vel</span>
                `;
                document.getElementById('add-to-cart-btn').disabled = true;
                document.getElementById('add-to-cart-btn').classList.add('opacity-50', 'cursor-not-allowed');
            }

            // Description - tenta buscar completa da Proesi
            if (product.description || product.sourceUrl) {
                document.getElementById('description-section').classList.remove('hidden');
                const descEl = document.getElementById('product-description');

                // Mostra descri√ß√£o local primeiro (pode estar truncada)
                if (product.description) {
                    descEl.innerHTML = formatDescription(product.description);
                }

                // Tenta buscar descri√ß√£o completa da Proesi
                if (product.sourceUrl) {
                    fetchFullDescription(product.sourceUrl, descEl);
                }
            }

            // Specs
            if (product.specs && Object.keys(product.specs).length > 0) {
                document.getElementById('specs-section').classList.remove('hidden');
                const specsTable = document.getElementById('specs-table');
                specsTable.innerHTML = Object.entries(product.specs).map(([key, value]) => `
                    <div class="flex justify-between py-3 border-b border-primary-700">
                        <span class="text-gray-400">${key}</span>
                        <span class="font-medium text-right">${value}</span>
                    </div>
                `).join('');
            }

            // Datasheet
            if (product.datasheet) {
                document.getElementById('datasheet-section').classList.remove('hidden');
                document.getElementById('datasheet-link').href = product.datasheet;
            }

            // Source link removido - Proesi bloqueia acesso externo (403)

            // WhatsApp link
            const whatsappMsg = `Ol√°! Tenho interesse no produto:\n\n*${product.name}*\nPre√ßo: ${product.priceFormatted || formatPrice(product.price)}\n\nPoderia me dar mais informa√ß√µes?`;
            document.getElementById('whatsapp-btn').href = `https://wa.me/5547988677798?text=${encodeURIComponent(whatsappMsg)}`;

            // Add to cart button
            document.getElementById('add-to-cart-btn').onclick = () => addToCart(product);

            // Buy now button - adds to cart and redirects to checkout
            document.getElementById('buy-now-btn').onclick = () => buyNow(product);

            // Related products
            renderRelatedProducts();
        }

        function setMainImage(src) {
            document.getElementById('main-image').src = src;

            // Update thumbnail active state
            const thumbnails = document.querySelectorAll('#thumbnails button');
            thumbnails.forEach(thumb => {
                const img = thumb.querySelector('img');
                if (img.src === src) {
                    thumb.classList.add('thumbnail-active', 'border-accent-400');
                    thumb.classList.remove('border-transparent');
                } else {
                    thumb.classList.remove('thumbnail-active', 'border-accent-400');
                    thumb.classList.add('border-transparent');
                }
            });
        }

        function renderRelatedProducts() {
            if (!product.category || allProducts.length < 2) return;

            const related = allProducts
                .filter(p => p.id !== product.id && p.category === product.category)
                .slice(0, 4);

            if (related.length === 0) return;

            document.getElementById('related-section').classList.remove('hidden');
            const container = document.getElementById('related-products');

            container.innerHTML = related.map(p => `
                <a href="produto.html?id=${encodeURIComponent(p.id)}" class="bg-primary-800 rounded-xl p-4 hover:bg-primary-700 transition-colors group">
                    <div class="aspect-square bg-primary-700 rounded-lg mb-3 overflow-hidden">
                        <img src="${p.image || 'https://via.placeholder.com/200x200?text=Sem+Imagem'}"
                             alt="${p.name}"
                             class="w-full h-full object-contain group-hover:scale-105 transition-transform"
                             loading="lazy">
                    </div>
                    <h3 class="font-medium text-sm line-clamp-2 mb-2">${p.name}</h3>
                    <p class="text-accent-400 font-bold">${p.priceFormatted || formatPrice(p.price)}</p>
                </a>
            `).join('');
        }

        // Cart functions
        function getCart() {
            return JSON.parse(localStorage.getItem('blumenau_cart') || '[]');
        }

        function saveCart(cart) {
            localStorage.setItem('blumenau_cart', JSON.stringify(cart));
            updateCartCount();
        }

        function addToCart(product) {
            const cart = getCart();
            const existing = cart.find(item => item.id === product.id);

            if (existing) {
                existing.quantity++;
            } else {
                cart.push({
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    priceFormatted: product.priceFormatted,
                    image: product.image,
                    sourceUrl: product.sourceUrl,
                    quantity: 1
                });
            }

            saveCart(cart);

            // Visual feedback
            const btn = document.getElementById('add-to-cart-btn');
            const originalText = btn.innerHTML;
            btn.innerHTML = `
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                Adicionado!
            `;
            btn.classList.add('bg-green-600');

            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.classList.remove('bg-green-600');
            }, 2000);
        }

        function buyNow(product) {
            // Clear cart and add only this product
            const cart = [{
                id: product.id,
                name: product.name,
                price: product.price,
                priceFormatted: product.priceFormatted,
                image: product.image,
                sourceUrl: product.sourceUrl,
                quantity: 1
            }];

            saveCart(cart);

            // Redirect to checkout
            window.location.href = 'checkout.html';
        }

        function updateCartCount() {
            const cart = getCart();
            const count = cart.reduce((sum, item) => sum + item.quantity, 0);
            const cartCountEl = document.getElementById('cart-count');
            if (cartCountEl) {
                if (count > 0) {
                    cartCountEl.textContent = count > 99 ? '99+' : count;
                    cartCountEl.classList.remove('hidden');
                } else {
                    cartCountEl.classList.add('hidden');
                }
            }
        }

        // Mobile menu
        document.getElementById('mobile-menu-btn').addEventListener('click', () => {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        });

        // Init
        if (productId || productSlug) {
            loadProduct();
        } else {
            showError();
        }
        updateCartCount();
    </script>

</body>
</html>
